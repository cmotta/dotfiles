# ╔══════════════════════════════════════════════════════════════╗
# ║  tmux.conf                                                   ║
# ║  Updated config — cmotta                                     ║
# ╚══════════════════════════════════════════════════════════════╝

# ─── Prefix ──────────────────────────────────────────────────
# Ctrl+A is ergonomic and avoids C-s flow control conflicts
unbind C-b
set -g prefix C-a
bind C-a send-prefix          # send literal C-a to nested sessions

# ─── Terminal & Colors ───────────────────────────────────────
set -g default-terminal "tmux-256color"
set -as terminal-overrides ",*:Tc"    # true color support

# ─── General Settings ────────────────────────────────────────
set -g mouse on                       # scroll, click panes, resize
set -g base-index 1                   # windows start at 1
setw -g pane-base-index 1             # panes too
set -g renumber-windows on            # no gaps after closing windows
set -g history-limit 50000            # generous scrollback
set -g display-time 4000              # status messages last 4s
set -sg escape-time 0                 # no delay after Esc (critical for vim)
set -g focus-events on                # for vim/neovim integration

# ─── Vi Mode & Copy ─────────────────────────────────────────
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
if-shell "uname | grep -q Darwin" \
  'bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"' \
  'bind -T copy-mode-vi y send -X copy-pipe-and-cancel "xclip -in -selection clipboard"'

# ─── Pane Navigation (vim-style) ────────────────────────────
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# ─── Pane Resizing ──────────────────────────────────────────
# -r flag allows repeating without pressing prefix again
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# ─── Intuitive Splits (in current path) ─────────────────────
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# ─── Window Navigation ──────────────────────────────────────
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# ─── Window Reordering ──────────────────────────────────────
bind -r < swap-window -d -t -1
bind -r > swap-window -d -t +1

# ─── Status Bar ──────────────────────────────────────────────
# Minimal but informative — session name + window list
set -g status-style "bg=#2e2e2e,fg=#cccccc"
set -g status-left "#[fg=#8be9fd,bold] #S "
set -g status-left-length 30
set -g status-right "#[fg=#666666]%H:%M "
setw -g window-status-format "#[fg=#888888] #I:#W "
setw -g window-status-current-format "#[fg=#f8f8f2,bg=#44475a,bold] #I:#W "

# ─── Pane Borders ───────────────────────────────────────────
set -g pane-border-style "fg=#444444"
set -g pane-active-border-style "fg=#8be9fd"

# ─── Utilities ───────────────────────────────────────────────
bind r source-file ~/.tmux.conf \; display "Config reloaded"
bind b break-pane                     # break pane into its own window
bind S command-prompt -p "join pane from:" "join-pane -s '%%'"

# ─── Plugins (via TPM) ──────────────────────────────────────
# Install TPM first:
#   git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
# Then press prefix + I to install plugins

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'

# Resurrect & Continuum settings
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'

# Initialize TPM (keep this at the very bottom)
if-shell "[ -d ~/.tmux/plugins/tpm ]" 'run ~/.tmux/plugins/tpm/tpm'

# ─── Local Overrides ────────────────────────────────────────
# Machine-specific tweaks go in ~/.tmux.conf.local
if-shell "[ -f ~/.tmux.conf.local ]" 'source ~/.tmux.conf.local'
